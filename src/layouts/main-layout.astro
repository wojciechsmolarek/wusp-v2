---
// layouts/main-layout.astro
import Navbar from '../components/navbar.astro'
import Footer from '../components/footer.tsx'

export interface LayoutProps {
  title: string
  description?: string
  robots?: string
  canonicalUrl?: string
}

const {
  title,
  description = "",
  robots = "index, follow",
  canonicalUrl
} = Astro.props as LayoutProps

const SITE_SUFFIX = "WUSP Jarocin"
const isHome = Astro.url.pathname === "/"
const pageTitle = isHome ? title : `${title} | ${SITE_SUFFIX}`
const canonical = canonicalUrl ?? new URL(Astro.url.pathname, Astro.site).toString()

const userAgent = Astro.request.headers.get('user-agent') || ''
const isBot = /bot|crawl|spider|slurp/i.test(userAgent)

const analyticsScript = `
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('consent', 'default', {
    'analytics_storage': 'denied',
    'ad_storage': 'denied',
    'functionality_storage': 'denied',
    'personalization_storage': 'denied'
  });
  gtag('config', 'G-YT20K3K922', {
    'send_page_view': true,
    'cookie_flags': 'SameSite=None;Secure',
    'debug_mode': true
  });
  console.log('GA4 zainicjalizowany');
  window.addEventListener('load', () => {
    console.log('Strona załadowana, sprawdzam GA4');
    if (typeof gtag !== 'undefined') {
      console.log('gtag jest zdefiniowany');
    } else {
      console.error('gtag nie jest zdefiniowany po załadowaniu strony');
    }
  });
`;
---

<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="robots" content={robots} />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <meta name="google-site-verification" content="xvXG3rZMSFvEn-K4FY67d0ngYVtCWBqN3y6E7zR20Dk" />

    <!-- Google Analytics -->
    {!isBot && (
      <>
        <script is:inline src="https://www.googletagmanager.com/gtag/js?id=G-YT20K3K922"></script>
        <script is:inline set:html={analyticsScript}></script>
      </>
    )}

    <!-- Global Styles -->
    <style>
      /* Optimized scrollbar hiding */
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      /* Enhanced focus styles for better accessibility */
      a:focus-visible {
        outline: 2px solid theme('colors.primary.200');
        outline-offset: 2px;
      }

      /* Smooth transitions for interactive elements */
      a, button {
        transition: all 0.2s ease-in-out;
      }
    </style>
  </head>
  <body>
    <main>
      <Navbar />
      <slot />
      <Footer />
    </main>
    <p class="tracking-tight text-base text-center border border-gray-300 bg-white py-10 lg:text-[18px] text-text-gray">
      Copyright © WUSP Jarocin | Utworzone przez <a href="https://www.wojciechsmolarek.pl/">Wojciecha Smolarka</a>
    </p>

    <script>
      import Alpine from 'alpinejs';
      import collapse from '@alpinejs/collapse';
      Alpine.plugin(collapse);
      // @ts-ignore
      window.Alpine = Alpine;
      Alpine.start();
    </script>

  </body>
</html>
